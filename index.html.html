<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced EHS Risk Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-light: #3498db;
            --secondary-light: #2c3e50;
            --background-light: #f5f7fa;
            --card-light: #ffffff;
            --text-light: #333333;
            --border-light: #dddddd;
            --success-light: #27ae60;
            --warning-light: #f39c12;
            --danger-light: #e74c3c;
            --extreme-light: #8e44ad;
            
            --primary-dark: #2980b9;
            --secondary-dark: #ecf0f1;
            --background-dark: #1a1a1a;
            --card-dark: #2d2d2d;
            --text-dark: #f5f5f5;
            --border-dark: #444444;
            --success-dark: #2ecc71;
            --warning-dark: #f1c40f;
            --danger-dark: #e67e22;
            --extreme-dark: #9b59b6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--background-light);
            color: var(--text-light);
            padding: 20px;
        }
        
        body.dark-mode {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-light);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode header {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: var(--primary-light);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .dark-mode h1 {
            color: var(--primary-dark);
        }
        
        .description {
            color: var(--text-light);
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
        }
        
        .dark-mode .description {
            color: var(--text-dark);
        }
        
        .theme-switch {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .theme-btn {
            background: var(--primary-light);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dark-mode .theme-btn {
            background: var(--primary-dark);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: var(--card-light);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .tabs {
            background: var(--card-dark);
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-light);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .dark-mode .tab.active {
            border-bottom: 3px solid var(--primary-dark);
            background-color: rgba(41, 128, 185, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .input-panel {
            flex: 1;
            min-width: 300px;
            background: var(--card-light);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .input-panel {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .matrix-container {
            flex: 2;
            min-width: 400px;
            background: var(--card-light);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .matrix-container {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--secondary-light);
            font-size: 1.1rem;
        }
        
        .dark-mode label {
            color: var(--secondary-dark);
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 1rem;
            background-color: var(--card-light);
            color: var(--text-light);
            transition: border-color 0.3s;
        }
        
        .dark-mode select, .dark-mode input, .dark-mode textarea {
            border-color: var(--border-dark);
            background-color: var(--card-dark);
            color: var(--text-dark);
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--primary-light);
            outline: none;
        }
        
        .dark-mode select:focus, .dark-mode input:focus, .dark-mode textarea:focus {
            border-color: var(--primary-dark);
        }
        
        button {
            padding: 12px 20px;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .dark-mode button {
            background: var(--primary-dark);
        }
        
        .dark-mode button:hover {
            background: #1c6ea4;
        }
        
        .btn-secondary {
            background: #7f8c8d;
        }
        
        .btn-secondary:hover {
            background: #6c7a7d;
        }
        
        .btn-success {
            background: var(--success-light);
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .risk-result {
            margin-top: 25px;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .risk-low {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-light);
            border: 2px solid var(--success-light);
        }
        
        .dark-mode .risk-low {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-dark);
            border: 2px solid var(--success-dark);
        }
        
        .risk-medium {
            background-color: rgba(241, 196, 15, 0.2);
            color: var(--warning-light);
            border: 2px solid var(--warning-light);
        }
        
        .dark-mode .risk-medium {
            background-color: rgba(241, 196, 15, 0.1);
            color: var(--warning-dark);
            border: 2px solid var(--warning-dark);
        }
        
        .risk-high {
            background-color: rgba(230, 126, 34, 0.2);
            color: var(--danger-light);
            border: 2px solid var(--danger-light);
        }
        
        .dark-mode .risk-high {
            background-color: rgba(230, 126, 34, 0.1);
            color: var(--danger-dark);
            border: 2px solid var(--danger-dark);
        }
        
        .risk-extreme {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--extreme-light);
            border: 2px solid var(--extreme-light);
        }
        
        .dark-mode .risk-extreme {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--extreme-dark);
            border: 2px solid var(--extreme-dark);
        }
        
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 5px;
            height: 400px;
            margin-top: 20px;
        }
        
        .matrix-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 5px;
            transition: all 0.3s;
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-light);
            border: 1px solid var(--success-light);
        }
        
        .dark-mode .matrix-cell {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-dark);
            border: 1px solid var(--success-dark);
        }
        
        .matrix-cell.medium {
            background-color: rgba(241, 196, 15, 0.2);
            color: var(--warning-light);
            border: 1px solid var(--warning-light);
        }
        
        .dark-mode .matrix-cell.medium {
            background-color: rgba(241, 196, 15, 0.1);
            color: var(--warning-dark);
            border: 1px solid var(--warning-dark);
        }
        
        .matrix-cell.high {
            background-color: rgba(230, 126, 34, 0.2);
            color: var(--danger-light);
            border: 1px solid var(--danger-light);
        }
        
        .dark-mode .matrix-cell.high {
            background-color: rgba(230, 126, 34, 0.1);
            color: var(--danger-dark);
            border: 1px solid var(--danger-dark);
        }
        
        .matrix-cell.extreme {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--extreme-light);
            border: 1px solid var(--extreme-light);
        }
        
        .dark-mode .matrix-cell.extreme {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--extreme-dark);
            border: 1px solid var(--extreme-dark);
        }
        
        .matrix-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background-color: var(--background-light);
            color: var(--text-light);
            border: 1px solid var(--border-light);
        }
        
        .dark-mode .matrix-label {
            background-color: var(--background-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }
        
        .examples {
            background: var(--card-light);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .dark-mode .examples {
            background: var(--card-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .examples h2 {
            color: var(--secondary-light);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-light);
        }
        
        .dark-mode .examples h2 {
            color: var(--secondary-dark);
            border-bottom: 2px solid var(--border-dark);
        }
        
        .example-item {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--background-light);
            border-left: 4px solid var(--primary-light);
            border-radius: 4px;
            position: relative;
        }
        
        .dark-mode .example-item {
            background-color: var(--background-dark);
            border-left: 4px solid var(--primary-dark);
        }
        
        .control-measures {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--primary-light);
        }
        
        .dark-mode .control-measures {
            background-color: rgba(41, 128, 185, 0.1);
            border-left: 4px solid var(--primary-dark);
        }
        
        .control-measures h3 {
            margin-bottom: 10px;
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dark-mode .control-measures h3 {
            color: var(--primary-dark);
        }
        
        .control-measures ul {
            padding-left: 20px;
        }
        
        .control-measures li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-light);
            font-size: 1rem;
            padding: 20px;
            background: var(--card-light);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode footer {
            background: var(--card-dark);
            color: var(--text-dark);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .signature {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--primary-light);
        }
        
        .dark-mode .signature {
            color: var(--primary-dark);
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
        
        .help-text {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .dark-mode .help-text {
            color: var(--text-dark);
        }
        
        .active-cell {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .hazard-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .hazard-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dark-mode .hazard-item {
            border-bottom: 1px solid var(--border-dark);
        }
        
        .hazard-risk {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .chart-container {
            background: var(--card-light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .chart-container {
            background: var(--card-dark);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .industry-selector {
            margin-bottom: 20px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            background-color: #2ecc71;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="theme-switch">
            <button class="theme-btn" id="theme-toggle">
                <i class="fas fa-moon"></i> Dark Mode
            </button>
        </div>
        
        <header>
            <h1><i class="fas fa-calculator"></i> Advanced EHS Risk Calculator</h1>
            <p class="description">Comprehensive Environment, Health, and Safety risk assessment tool with advanced features for professionals.</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="single">Single Hazard Assessment</div>
            <div class="tab" data-tab="multiple">Multiple Hazards Register</div>
            <div class="tab" data-tab="dashboard">Risk Dashboard</div>
            <div class="tab" data-tab="templates">Industry Templates</div>
        </div>
        
        <div class="tab-content active" id="single-tab">
            <div class="main-content">
                <div class="input-panel">
                    <h2><i class="fas fa-sliders-h"></i> Risk Assessment Input</h2>
                    
                    <div class="industry-selector">
                        <label for="industry">Select Industry:</label>
                        <select id="industry">
                            <option value="general">General</option>
                            <option value="construction">Construction</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="laboratory">Laboratory</option>
                            <option value="office">Office</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hazard-description"><i class="fas fa-exclamation-triangle"></i> Hazard Description:</label>
                        <textarea id="hazard-description" rows="3" placeholder="Describe the hazard..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="probability"><i class="fas fa-chart-line"></i> Probability/Likelihood:</label>
                        <select id="probability">
                            <option value="1">1 - Rare (Very unlikely to occur)</option>
                            <option value="2">2 - Unlikely (Not expected to occur)</option>
                            <option value="3">3 - Possible (Might occur occasionally)</option>
                            <option value="4">4 - Likely (Will probably occur)</option>
                            <option value="5">5 - Almost Certain (Expected to occur)</option>
                        </select>
                        <p class="help-text">How likely is the hazard to occur?</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="severity"><i class="fas fa-exclamation-triangle"></i> Severity/Impact:</label>
                        <select id="severity">
                            <option value="1">1 - Negligible (No injuries, minimal loss)</option>
                            <option value="2">2 - Minor (First aid treatment, minor damage)</option>
                            <option value="3">3 - Moderate (Medical treatment, equipment damage)</option>
                            <option value="4">4 - Major (Serious injuries, significant loss)</option>
                            <option value="5">5 - Catastrophic (Death, extensive damage)</option>
                        </select>
                        <p class="help-text">How severe would the impact be if the hazard occurred?</p>
                    </div>
                    
                    <button id="calculate-btn"><i class="fas fa-calculator"></i> Calculate Risk Level</button>
                    <button id="add-to-register" class="btn-success"><i class="fas fa-plus"></i> Add to Register</button>
                    
                    <div id="risk-result" class="risk-result">
                        Risk Level: Please calculate
                    </div>
                    
                    <div id="control-measures" class="control-measures">
                        <h3><i class="fas fa-clipboard-list"></i> Recommended Control Measures</h3>
                        <div id="measures-list">Calculate risk to see recommended control measures</div>
                    </div>
                </div>
                
                <div class="matrix-container">
                    <h2><i class="fas fa-th"></i> Risk Matrix</h2>
                    <p>The matrix shows how probability and severity combine to determine risk levels:</p>
                    <div class="risk-matrix" id="risk-matrix">
                        <!-- Matrix will be generated by JavaScript -->
                    </div>
                    
                    <div class="action-buttons">
                        <button id="export-pdf" class="btn-secondary"><i class="fas fa-file-pdf"></i> Export PDF</button>
                        <button id="export-excel" class="btn-secondary"><i class="fas fa-file-excel"></i> Export Excel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="multiple-tab">
            <div class="input-panel">
                <h2><i class="fas fa-list-alt"></i> Risk Register</h2>
                <p>View and manage all assessed hazards in your risk register:</p>
                
                <div class="hazard-list" id="hazard-list">
                    <div class="hazard-item">
                        <div>No hazards added yet</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="clear-register" class="btn-secondary"><i class="fas fa-trash"></i> Clear Register</button>
                    <button id="export-register-pdf" class="btn-success"><i class="fas fa-file-pdf"></i> Export Full Report (PDF)</button>
                    <button id="export-register-excel" class="btn-success"><i class="fas fa-file-excel"></i> Export Full Report (Excel)</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="dashboard-tab">
            <div class="input-panel">
                <h2><i class="fas fa-chart-bar"></i> Risk Dashboard</h2>
                <p>Visualization of your risk assessment data:</p>
                
                <div class="dashboard">
                    <div class="chart-container">
                        <h3>Risk Distribution</h3>
                        <canvas id="riskDistributionChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Risk by Category</h3>
                        <canvas id="riskCategoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="templates-tab">
            <div class="input-panel">
                <h2><i class="fas fa-clipboard-list"></i> Industry Templates</h2>
                <p>Select an industry template to load common hazards:</p>
                
                <div class="form-group">
                    <label for="template-industry">Industry:</label>
                    <select id="template-industry">
                        <option value="construction">Construction</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="laboratory">Laboratory</option>
                        <option value="office">Office</option>
                    </select>
                </div>
                
                <button id="load-template"><i class="fas fa-download"></i> Load Template</button>
                
                <div id="template-hazards" class="hazard-list">
                    <div class="hazard-item">
                        <div>Select an industry and load template to see hazards</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>EHS Risk Calculator Tool | Automating Safety Assessments | © 2025</p>
            <p class="signature">Powered by Muhammad Talib Raza</p>
        </footer>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Industry-specific hazard templates
        const hazardTemplates = {
            construction: [
                { description: "Fall from height", probability: 4, severity: 5 },
                { description: "Struck by falling object", probability: 3, severity: 4 },
                { description: "Electrical hazard", probability: 3, severity: 4 },
                { description: "Caught in/between machinery", probability: 2, severity: 5 },
                { description: "Exposure to hazardous materials", probability: 3, severity: 3 }
            ],
            manufacturing: [
                { description: "Machine entanglement", probability: 3, severity: 5 },
                { description: "Repetitive strain injury", probability: 4, severity: 3 },
                { description: "Exposure to loud noise", probability: 4, severity: 3 },
                { description: "Chemical exposure", probability: 3, severity: 4 },
                { description: "Slip and trip hazards", probability: 4, severity: 2 }
            ],
            healthcare: [
                { description: "Needlestick injury", probability: 3, severity: 3 },
                { description: "Exposure to infectious diseases", probability: 3, severity: 4 },
                { description: "Patient handling injury", probability: 4, severity: 3 },
                { description: "Workplace violence", probability: 2, severity: 4 },
                { description: "Slip and fall on wet floors", probability: 3, severity: 2 }
            ],
            laboratory: [
                { description: "Chemical exposure", probability: 3, severity: 4 },
                { description: "Fire/explosion risk", probability: 2, severity: 5 },
                { description: "Biological exposure", probability: 2, severity: 4 },
                { description: "Sharp object injury", probability: 3, severity: 2 },
                { description: "Radiation exposure", probability: 1, severity: 5 }
            ],
            office: [
                { description: "Ergonomic injuries", probability: 4, severity: 2 },
                { description: "Eye strain from screens", probability: 4, severity: 2 },
                { description: "Slip and trip hazards", probability: 3, severity: 2 },
                { description: "Electrical hazards", probability: 2, severity: 3 },
                { description: "Stress and burnout", probability: 4, severity: 3 }
            ]
        };

        // Control measures by risk level
        const controlMeasures = {
            low: [
                "Ensure good housekeeping practices",
                "Maintain clear warning signs",
                "Provide basic training and awareness"
            ],
            medium: [
                "Implement administrative controls",
                "Develop safe work procedures",
                "Provide specific training",
                "Schedule regular inspections"
            ],
            high: [
                "Implement engineering controls",
                "Use personal protective equipment",
                "Develop emergency procedures",
                "Conduct regular safety audits",
                "Provide specialized training"
            ],
            extreme: [
                "Eliminate hazard if possible",
                "Implement multiple control layers",
                "Use highest level of PPE",
                "Implement continuous monitoring",
                "Establish strict access controls",
                "Develop comprehensive emergency response plans"
            ]
        };

        // Industry-specific control measures
        const industryControlMeasures = {
            construction: {
                extreme: [
                    "Implement fall protection systems",
                    "Use safety harnesses and guardrails",
                    "Establish exclusion zones",
                    "Conduct daily safety meetings",
                    "Provide specialized equipment training"
                ]
            },
            manufacturing: {
                extreme: [
                    "Install machine guards and safety interlocks",
                    "Implement lockout/tagout procedures",
                    "Use appropriate PPE for each task",
                    "Establish equipment maintenance schedules",
                    "Provide hazard-specific training"
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculate-btn');
            const probabilitySelect = document.getElementById('probability');
            const severitySelect = document.getElementById('severity');
            const riskResult = document.getElementById('risk-result');
            const riskMatrix = document.getElementById('risk-matrix');
            const themeToggle = document.getElementById('theme-toggle');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const addToRegisterBtn = document.getElementById('add-to-register');
            const hazardDescription = document.getElementById('hazard-description');
            const hazardList = document.getElementById('hazard-list');
            const clearRegisterBtn = document.getElementById('clear-register');
            const industrySelect = document.getElementById('industry');
            const templateIndustry = document.getElementById('template-industry');
            const loadTemplateBtn = document.getElementById('load-template');
            const templateHazards = document.getElementById('template-hazards');
            const exportPdfBtn = document.getElementById('export-pdf');
            const exportExcelBtn = document.getElementById('export-excel');
            const exportRegisterPdfBtn = document.getElementById('export-register-pdf');
            const exportRegisterExcelBtn = document.getElementById('export-register-excel');
            const notification = document.getElementById('notification');
            
            let hazards = [];
            let riskDistributionChart = null;
            let riskCategoryChart = null;
            
            // Initialize the app
            createMatrix();
            initCharts();
            
            // Tab switching functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // Update charts when dashboard is opened
                    if (tabId === 'dashboard') {
                        updateCharts();
                    }
                });
            });
            
            // Theme toggle functionality
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
                    showNotification('Dark mode enabled');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
                    showNotification('Light mode enabled');
                }
            });
            
            // Show notification
            function showNotification(message, isError = false) {
                notification.textContent = message;
                notification.classList.remove('error');
                
                if (isError) {
                    notification.classList.add('error');
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Create risk matrix
            function createMatrix() {
                // Clear existing matrix
                riskMatrix.innerHTML = '';
                
                // Add empty corner
                riskMatrix.appendChild(createMatrixCell('', 'matrix-label'));
                
                // Add severity labels (top row)
                for (let s = 1; s <= 5; s++) {
                    riskMatrix.appendChild(createMatrixCell(`S${s}`, 'matrix-label'));
                }
                
                // Add probability labels and matrix cells
                for (let p = 1; p <= 5; p++) {
                    // Probability label (first column)
                    riskMatrix.appendChild(createMatrixCell(`P${p}`, 'matrix-label'));
                    
                    // Matrix cells
                    for (let s = 1; s <= 5; s++) {
                        const riskLevel = calculateRiskLevel(p, s);
                        riskMatrix.appendChild(createMatrixCell(
                            `P${p}S${s}`, 
                            `matrix-cell ${riskLevel}`,
                            `Probability: ${getProbabilityLabel(p)}, Severity: ${getSeverityLabel(s)}`
                        ));
                    }
                }
            }
            
            function createMatrixCell(text, className, title = '') {
                const cell = document.createElement('div');
                cell.className = className;
                cell.textContent = text;
                if (title) cell.title = title;
                return cell;
            }
            
            function calculateRiskLevel(probability, severity) {
                const riskScore = probability * severity;
                
                if (riskScore <= 3) return 'low';
                if (riskScore <= 8) return 'medium';
                if (riskScore <= 12) return 'high';
                return 'extreme';
            }
            
            function getProbabilityLabel(value) {
                const options = probabilitySelect.options;
                return options[value - 1].text.split(' - ')[1];
            }
            
            function getSeverityLabel(value) {
                const options = severitySelect.options;
                return options[value - 1].text.split(' - ')[1];
            }
            
            function updateMatrixHighlight(probability, severity) {
                const cells = riskMatrix.querySelectorAll('.matrix-cell');
                cells.forEach(cell => {
                    cell.classList.remove('active-cell');
                    
                    const cellText = cell.textContent;
                    if (cellText === `P${probability}S${severity}`) {
                        cell.classList.add('active-cell');
                    }
                });
            }
            
            function getControlMeasures(riskLevel, industry = 'general') {
                let measures = [...controlMeasures[riskLevel]];
                
                // Add industry-specific measures if available
                if (industryControlMeasures[industry] && industryControlMeasures[industry][riskLevel]) {
                    measures = [...measures, ...industryControlMeasures[industry][riskLevel]];
                }
                
                return measures;
            }
            
            function displayControlMeasures(riskLevel) {
                const industry = industrySelect.value;
                const measures = getControlMeasures(riskLevel, industry);
                const measuresList = document.getElementById('measures-list');
                
                measuresList.innerHTML = '';
                const ul = document.createElement('ul');
                
                measures.forEach(measure => {
                    const li = document.createElement('li');
                    li.textContent = measure;
                    ul.appendChild(li);
                });
                
                measuresList.appendChild(ul);
            }
            
            function addHazardToRegister() {
                const probability = parseInt(probabilitySelect.value);
                const severity = parseInt(severitySelect.value);
                const description = hazardDescription.value.trim();
                const industry = industrySelect.value;
                
                if (!description) {
                    showNotification('Please enter a hazard description', true);
                    return;
                }
                
                const riskLevel = calculateRiskLevel(probability, severity);
                
                const hazard = {
                    id: Date.now(),
                    description,
                    probability,
                    severity,
                    riskLevel,
                    industry,
                    timestamp: new Date().toLocaleString()
                };
                
                hazards.push(hazard);
                updateHazardList();
                updateCharts();
                
                showNotification('Hazard added to register successfully');
            }
            
            function updateHazardList() {
                hazardList.innerHTML = '';
                
                if (hazards.length === 0) {
                    hazardList.innerHTML = '<div class="hazard-item"><div>No hazards added yet</div></div>';
                    return;
                }
                
                hazards.forEach(hazard => {
                    const item = document.createElement('div');
                    item.className = 'hazard-item';
                    
                    item.innerHTML = `
                        <div>
                            <strong>${hazard.description}</strong>
                            <div class="help-text">${hazard.industry} • P${hazard.probability}/S${hazard.severity}</div>
                        </div>
                        <div class="hazard-risk risk-${hazard.riskLevel}">${hazard.riskLevel.toUpperCase()}</div>
                    `;
                    
                    hazardList.appendChild(item);
                });
            }
            
            function clearRegister() {
                if (confirm('Are you sure you want to clear all hazards from the register?')) {
                    hazards = [];
                    updateHazardList();
                    updateCharts();
                    showNotification('Register cleared successfully');
                }
            }
            
            function initCharts() {
                const riskDistCtx = document.getElementById('riskDistributionChart').getContext('2d');
                const riskCatCtx = document.getElementById('riskCategoryChart').getContext('2d');
                
                riskDistributionChart = new Chart(riskDistCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Low', 'Medium', 'High', 'Extreme'],
                        datasets: [{
                            label: 'Number of Hazards',
                            data: [0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(241, 196, 15, 极速模式)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(231, 76, 60, 0.7)'
                            ],
                            borderColor: [
                                'rgb(46, 204, 113)',
                                'rgb(241, 196, 15)',
                                'rgb(230, 126, 34)',
                                'rgb(231, 76, 60)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
                
                riskCategoryChart = new Chart(riskCatCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Construction', 'Manufacturing', 'Healthcare', 'Laboratory', 'Office', 'General'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0, 0],
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.7)',
                                '极速模式(155, 89, 182, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(241, 196, 15, 0.7)',
                                'rgba(230, 126, 34, 0.7)',
                                'rgba(231, 76, 60, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            }
            
            function updateCharts() {
                if (!riskDistributionChart || !riskCategoryChart) return;
                
                // Update risk distribution chart
                const riskCounts = {
                    low: 0,
                    medium: 0,
                    high: 0,
                    extreme: 0
                };
                
                hazards.forEach(hazard => {
                    riskCounts[hazard.riskLevel]++;
                });
                
                riskDistributionChart.data.datasets[0].data = [
                    riskCounts.low,
                    riskCounts.medium,
                    riskCounts.high,
                    riskCounts.extreme
                ];
                
                riskDistributionChart.update();
                
                // Update risk category chart
                const industryCounts = {
                    construction: 0,
                    manufacturing: 0,
                    healthcare: 0,
                    laboratory: 0,
                    office: 0,
                    general: 0
                };
                
                hazards.forEach(hazard => {
                    industryCounts[hazard.industry]++;
                });
                
                riskCategoryChart.data.datasets[0].data = [
                    industryCounts.construction,
                    industryCounts.manufacturing,
                    industryCounts.healthcare,
                    industryCounts.laboratory,
                    industryCounts.office,
                    industryCounts.general
                ];
                
                riskCategoryChart.update();
            }
            
            function loadIndustryTemplate() {
                const industry = templateIndustry.value;
                const template = hazardTemplates[industry];
                
                templateHazards.innerHTML = '';
                
                template.forEach(hazard => {
                    const riskLevel = calculateRiskLevel(hazard.probability, hazard.severity);
                    
                    const item = document.createElement('div');
                    item.className = 'hazard-item';
                    
                    item.innerHTML = `
                        <div>
                            <strong>${hazard.description}</strong>
                            <div class="help-text">P${hazard.probability}/S${hazard.severity}</div>
                        </div>
                        <div class="hazard-risk risk-${riskLevel}">${riskLevel.toUpperCase()}</div>
                    `;
                    
                    templateHazards.appendChild(item);
                });
                
                showNotification(`Loaded ${industry} template`);
            }
            
            function exportToPDF() {
                // Simulate export process
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="loading"></span> Exporting...';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    showNotification('PDF report generated successfully');
                }, 1500);
            }
            
            function exportToExcel() {
                // Simulate export process
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="loading"></span> Exporting...';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    showNotification('Excel report generated successfully');
                }, 1500);
            }
            
            // Event listeners
            calculateBtn.addEventListener('click', function() {
                const probability = parseInt(probabilitySelect.value);
                const severity = parseInt(severitySelect.value);
                
                const riskLevel = calculateRiskLevel(probability, severity);
                
                // Update risk result display
                riskResult.textContent = `Risk Level: ${riskLevel.charAt(0).toUpperCase() + riskLevel.slice(1)} Risk`;
                riskResult.className = `risk-result risk-${riskLevel}`;
                
                // Update matrix highlight
                updateMatrixHighlight(probability, severity);
                
                // Display control measures
                displayControlMeasures(riskLevel);
                
                showNotification('Risk calculation completed');
            });
            
            addToRegisterBtn.addEventListener('click', addHazardToRegister);
            clearRegisterBtn.addEventListener('click', clearRegister);
            loadTemplateBtn.addEventListener('click', loadIndustryTemplate);
            exportPdfBtn.addEventListener('click', exportToPDF);
            exportExcelBtn.addEventListener('click', exportToExcel);
            exportRegisterPdfBtn.addEventListener('click', exportToPDF);
            exportRegisterExcelBtn.addEventListener('click', exportToExcel);
        });
    </script>
</body>
</html>